# Retrieval Test Cases for research-kb
# Master Plan Reference: Lines 596-601, 1382-1383
#
# Each test case specifies:
# - query: The search query
# - expected_source: Source identifier that should appear in results
# - expected_in_top_k: Result should be in top K results
# - expected_page_range: Optional page range for verification
# - tags: Categories for filtering

test_cases:
  # Core causal inference concepts (backdoor criterion test)
  - query: "backdoor criterion"
    expected_source_pattern: "causality.*models|reasoning|inference"
    expected_in_top_k: 5
    expected_page_range: [75, 375]
    tags: [core, pearl, causal_inference]
    notes: "Master Plan Line 597: backdoor criterion → Pearl's Causality book"

  # Cross-fitting test (DML paper or related sources)
  - query: "cross-fitting"
    expected_source_pattern: "double.*debiased|machine learning|causal.*inference|effect"
    expected_in_top_k: 5
    tags: [core, dml, causal_inference]
    notes: "Master Plan Line 598: cross-fitting → DML-related sources"

  # Instrumental variables (should return econometrics sources)
  - query: "instrumental variables"
    expected_source_pattern: "mostly harmless|instrumental|econometric|panel.*data|effect"
    expected_in_top_k: 5
    expect_mixed_sources: true
    expected_concepts: ["instrumental variables", "LATE", "exclusion restriction", "relevance"]
    relevance_grade: 3
    tags: [core, iv, econometrics]
    notes: "Master Plan Line 610: IV should return mixed sources"

  # Potential outcomes framework
  - query: "potential outcomes"
    expected_source_pattern: "causal|treatment|counterfactual"
    expected_in_top_k: 5
    tags: [core, causal_inference]

  # Propensity score matching
  - query: "propensity score matching"
    expected_source_pattern: "matching|propensity"
    expected_in_top_k: 5
    expected_concepts: ["propensity score", "matching", "selection bias", "common support"]
    relevance_grade: 3
    tags: [core, matching]

  # LATE / Local Average Treatment Effect
  - query: "local average treatment effect"
    expected_source_pattern: "mostly harmless|econometrics|nobel|treatment|effect|mediation"
    expected_in_top_k: 5
    tags: [core, iv]

  # Causal DAGs
  - query: "directed acyclic graph causal"
    expected_source_pattern: "causal|inference|prediction|search"
    expected_in_top_k: 5
    tags: [core, graphs]

  # Double machine learning
  - query: "double machine learning"
    expected_source_pattern: "double.*debiased|machine learning|causal|effect|ai"
    expected_in_top_k: 5
    expected_concepts: ["double machine learning", "cross-fitting", "Neyman orthogonality", "nuisance"]
    relevance_grade: 3
    tags: [core, dml, ml]

  # Heterogeneous treatment effects
  - query: "heterogeneous treatment effects"
    expected_source_pattern: "heterogeneous|recursive partitioning|treatment"
    expected_in_top_k: 5
    tags: [hte, ml]

  # Selection bias
  - query: "selection bias observational"
    expected_source_pattern: "mostly harmless|econometrics|causal"
    expected_in_top_k: 5
    tags: [bias, causal_inference]

  # ===== Phase 1 Cleanup: 4 Concept-Gap Tests =====
  # NOTE: RDD and sensitivity papers skipped (not on arXiv)

  # Synthetic control methods
  - query: "synthetic control experimental design"
    expected_source_pattern: "synthetic control.*experimental"
    expected_in_top_k: 5
    tags: [core, synthetic_control]
    notes: "Phase 1 cleanup: Abadie/Zhao 2021 (arXiv:2108.02196)"

  # Causal forests
  - query: "causal forest random forests heterogeneous"
    expected_source_pattern: "heterogeneous treatment effects.*random forests"
    expected_in_top_k: 5
    tags: [core, causal_forest, ml]
    notes: "Phase 1 cleanup: Wager/Athey 2018"

  # Causal mediation analysis
  - query: "causal mediation identification inference"
    expected_source_pattern: "mediation|causal.*inference|interaction|primer"
    expected_in_top_k: 5
    tags: [core, mediation]
    notes: "Phase 1 cleanup: Imai et al. 2010 (arXiv:1011.1079)"

  # Staggered difference-in-differences
  - query: "staggered difference in differences multiple time periods"
    expected_source_pattern: "difference.*differences.*multiple|time periods"
    expected_in_top_k: 5
    tags: [core, staggered_did]
    notes: "Phase 1 cleanup: Callaway/Sant'Anna 2021"

  # ===== Phase 2: Expanded Golden Dataset (2026-01-15) =====
  # LLM-generated candidates (curated) + manual additions

  # Bayesian networks for causal inference
  - query: "bayesian networks for causal inference"
    expected_source_pattern: "koller|friedman|pgm|graphical|causality.*models|elements.*causal"
    expected_in_top_k: 5
    expected_concepts: ["bayesian network", "causal graph", "probabilistic inference"]
    relevance_grade: 3
    tags: [phase2, bayesian, graphs]
    notes: "Phase 2 expansion: Pearl or Koller/Friedman books"

  # Effect size
  - query: "effect size statistical power sample"
    expected_source_pattern: "statistical|power|analysis|behavioral"
    expected_in_top_k: 5
    expected_concepts: ["effect size", "statistical power", "sample size"]
    relevance_grade: 3
    tags: [phase2, power_analysis]
    notes: "Phase 2 expansion: Cohen's Statistical Power Analysis"

  # Endogeneity
  - query: "endogeneity regression bias"
    expected_source_pattern: "econometric|analysis|wooldridge|panel"
    expected_in_top_k: 5
    expected_concepts: ["endogeneity", "omitted variable bias", "instrumental variables"]
    relevance_grade: 3
    tags: [phase2, econometrics, endogeneity]
    notes: "Phase 2 expansion: Wooldridge Econometric Analysis"

  # Confounding
  - query: "confounding variables observational studies adjustment"
    expected_source_pattern: "causal|inference|what|hernan|robins"
    expected_in_top_k: 5
    expected_concepts: ["confounding", "adjustment", "backdoor path"]
    relevance_grade: 3
    tags: [phase2, confounding, causal_inference]
    notes: "Phase 2 expansion: Hernan & Robins What If"

  # Natural indirect effect
  - query: "natural indirect effect mediation"
    expected_source_pattern: "explanation|causal|mediation|interaction|vanderweele"
    expected_in_top_k: 5
    expected_concepts: ["natural indirect effect", "mediation", "direct effect"]
    relevance_grade: 3
    tags: [phase2, mediation, effects]
    notes: "Phase 2 expansion: VanderWeele mediation book"

  # Natural direct effect
  - query: "controlled direct effect causal"
    expected_source_pattern: "explanation|causal|mediation|interaction|vanderweele"
    expected_in_top_k: 5
    expected_concepts: ["controlled direct effect", "direct effect", "mediation"]
    relevance_grade: 3
    tags: [phase2, mediation, effects]
    notes: "Phase 2 expansion: VanderWeele mediation book"

  # Consistency assumption
  - query: "consistency assumption potential outcomes"
    expected_source_pattern: "econometric|causal|what|treatment"
    expected_in_top_k: 5
    expected_concepts: ["consistency", "SUTVA", "potential outcomes"]
    relevance_grade: 3
    tags: [phase2, assumptions]
    notes: "Phase 2 expansion: Fundamental causal assumption"

  # Sensitivity analysis
  - query: "sensitivity analysis unmeasured confounding"
    expected_source_pattern: "explanation|causal|sensitivity|rosenbaum"
    expected_in_top_k: 5
    expected_concepts: ["sensitivity analysis", "unmeasured confounding", "robustness"]
    relevance_grade: 3
    tags: [phase2, sensitivity, robustness]
    notes: "Phase 2 expansion: VanderWeele or Rosenbaum sensitivity methods"

  # Power analysis
  - query: "sample size power calculation"
    expected_source_pattern: "statistical|power|analysis|behavioral|cohen|mediation|openintro"
    expected_in_top_k: 5
    expected_concepts: ["power analysis", "effect size", "sample size", "Type II error"]
    relevance_grade: 3
    tags: [phase2, power_analysis, experimental_design]
    notes: "Phase 2 expansion: Cohen's Power Analysis or stats textbooks"

  # ===== Manual additions for methodological coverage =====

  # Regression discontinuity design
  - query: "regression discontinuity design sharp fuzzy"
    expected_source_pattern: "mostly harmless|econometrics|causal|angrist"
    expected_in_top_k: 5
    expected_concepts: ["regression discontinuity", "running variable", "bandwidth"]
    relevance_grade: 3
    tags: [phase2, rdd, quasi_experimental]
    notes: "Phase 2 manual: Angrist & Pischke RDD coverage"

  # Inverse probability weighting
  - query: "inverse probability weighting treatment effects"
    expected_source_pattern: "causal|inference|what|hernan|propensity"
    expected_in_top_k: 5
    expected_concepts: ["inverse probability weighting", "propensity score", "weighting"]
    relevance_grade: 3
    tags: [phase2, ipw, weighting]
    notes: "Phase 2 manual: Hernan & Robins IPW methods"

  # Doubly robust estimation
  - query: "doubly robust estimation AIPW"
    expected_source_pattern: "causal|inference|double|debiased|treatment"
    expected_in_top_k: 5
    expected_concepts: ["doubly robust", "AIPW", "augmented IPW"]
    relevance_grade: 3
    tags: [phase2, doubly_robust, ml]
    notes: "Phase 2 manual: Doubly robust / AIPW estimators"

  # Two-stage least squares
  - query: "two stage least squares IV estimation"
    expected_source_pattern: "mostly harmless|econometric|instrumental|wooldridge"
    expected_in_top_k: 5
    expected_concepts: ["two-stage least squares", "2SLS", "first stage", "instrumental variables"]
    relevance_grade: 3
    tags: [phase2, iv, 2sls]
    notes: "Phase 2 manual: Core IV estimation method"

  # Overlap/positivity assumption
  - query: "overlap assumption positivity propensity"
    expected_source_pattern: "causal|inference|what|propensity|treatment"
    expected_in_top_k: 5
    expected_concepts: ["overlap", "positivity", "propensity score", "common support"]
    relevance_grade: 3
    tags: [phase2, assumptions, propensity]
    notes: "Phase 2 manual: Key identifiability assumption"

  # Bunching estimator
  - query: "bunching estimator kink threshold"
    expected_source_pattern: "bunching|public|economics|kleven|state.*applied|effect"
    expected_in_top_k: 5
    expected_concepts: ["bunching estimator", "notch", "kink", "elasticity"]
    relevance_grade: 3
    tags: [phase2, bunching, public_economics]
    notes: "Phase 2 manual: Bunching in applied econ sources"

  # Weak instruments
  - query: "weak instruments bias IV"
    expected_source_pattern: "mostly harmless|econometric|instrumental|weak"
    expected_in_top_k: 5
    expected_concepts: ["weak instruments", "F-statistic", "bias", "2SLS"]
    relevance_grade: 3
    tags: [phase2, iv, weak_instruments]
    notes: "Phase 2 manual: IV robustness concern"

  # ===== Phase J: Multi-Domain Expansion (2026-02-20) =====

  # --- Time Series ---
  - query: "ARIMA model identification"
    expected_source_pattern: "time series|forecasting|shumway|stoffer"
    expected_in_top_k: 5
    expected_concepts: ["ARIMA", "autocorrelation", "differencing", "stationarity"]
    relevance_grade: 3
    tags: [phase_j, time_series]
    notes: "Phase J: Time series core method"

  - query: "exponential smoothing forecasting"
    expected_source_pattern: "time series|forecasting|hyndman|holt"
    expected_in_top_k: 5
    expected_concepts: ["exponential smoothing", "Holt-Winters", "trend", "seasonality"]
    relevance_grade: 3
    tags: [phase_j, time_series]
    notes: "Phase J: Forecasting core technique"

  - query: "Granger causality temporal"
    expected_source_pattern: "time series|hamilton|var|granger"
    expected_in_top_k: 5
    expected_concepts: ["Granger causality", "vector autoregression", "temporal ordering"]
    relevance_grade: 3
    tags: [phase_j, time_series]
    notes: "Phase J: Temporal causality concept"

  # --- Deep Learning ---
  - query: "attention mechanism transformer architecture"
    expected_source_pattern: "deep learning|transformer|attention|natural language"
    expected_in_top_k: 5
    expected_concepts: ["attention", "transformer", "self-attention", "multi-head"]
    relevance_grade: 3
    tags: [phase_j, deep_learning]
    notes: "Phase J: Core DL architecture"

  - query: "convolutional neural network image classification"
    expected_source_pattern: "deep learning|cnn|convolutional|tensorflow|pattern"
    expected_in_top_k: 5
    expected_concepts: ["convolution", "pooling", "feature map", "filter"]
    relevance_grade: 3
    tags: [phase_j, deep_learning]
    notes: "Phase J: CNN fundamentals"

  - query: "vanishing gradient deep networks"
    expected_source_pattern: "deep learning|evolutionary|gradient|neural"
    expected_in_top_k: 5
    expected_concepts: ["vanishing gradient", "residual connection", "batch normalization"]
    relevance_grade: 3
    tags: [phase_j, deep_learning]
    notes: "Phase J: Training challenge"

  # --- Software Engineering ---
  - query: "SOLID design principles"
    expected_source_pattern: "code|software|design|clean|skills"
    expected_in_top_k: 5
    expected_concepts: ["single responsibility", "open-closed", "dependency inversion"]
    relevance_grade: 3
    tags: [phase_j, software_engineering]
    notes: "Phase J: Design principles"

  - query: "microservice vs monolith architecture"
    expected_source_pattern: "software|architecture|microservice|monolith|code"
    expected_in_top_k: 5
    expected_concepts: ["microservice", "monolith", "coupling", "scalability"]
    relevance_grade: 3
    tags: [phase_j, software_engineering]
    notes: "Phase J: Architecture decision"

  - query: "continuous integration deployment pipeline"
    expected_source_pattern: "github|actions|publishing|python|ci|deployment|code"
    expected_in_top_k: 5
    expected_concepts: ["continuous integration", "deployment", "pipeline", "automation"]
    relevance_grade: 3
    tags: [phase_j, software_engineering]
    notes: "Phase J: CI/CD practices"

  # --- Statistics ---
  - query: "Bayesian posterior inference"
    expected_source_pattern: "bayesian|statistics|posterior|gelman|donovan"
    expected_in_top_k: 5
    expected_concepts: ["posterior", "prior", "likelihood", "Bayes theorem"]
    relevance_grade: 3
    tags: [phase_j, statistics]
    notes: "Phase J: Bayesian inference"

  - query: "hypothesis testing p-value"
    expected_source_pattern: "statistics|openintro|hypothesis|biostat"
    expected_in_top_k: 5
    expected_concepts: ["p-value", "null hypothesis", "type I error", "significance"]
    relevance_grade: 3
    tags: [phase_j, statistics]
    notes: "Phase J: Frequentist inference"

  - query: "bootstrap confidence interval"
    expected_source_pattern: "statistics|bootstrap|biostat|resampling"
    expected_in_top_k: 5
    expected_concepts: ["bootstrap", "confidence interval", "resampling"]
    relevance_grade: 3
    tags: [phase_j, statistics]
    notes: "Phase J: Nonparametric inference"

  # --- Machine Learning ---
  - query: "random forest ensemble learning"
    expected_source_pattern: "ensemble|random forest|machine learning|bagging"
    expected_in_top_k: 5
    expected_concepts: ["random forest", "bagging", "feature importance", "ensemble"]
    relevance_grade: 3
    tags: [phase_j, machine_learning]
    notes: "Phase J: Ensemble method"

  - query: "gradient boosting XGBoost"
    expected_source_pattern: "ensemble|gradient|boosting|machine learning"
    expected_in_top_k: 5
    expected_concepts: ["gradient boosting", "XGBoost", "residual fitting", "ensemble"]
    relevance_grade: 3
    tags: [phase_j, machine_learning]
    notes: "Phase J: Boosting method"

  - query: "bias variance tradeoff model selection"
    expected_source_pattern: "machine learning|mathematics|learning|pattern"
    expected_in_top_k: 5
    expected_concepts: ["bias-variance tradeoff", "overfitting", "underfitting", "generalization"]
    relevance_grade: 3
    tags: [phase_j, machine_learning]
    notes: "Phase J: Fundamental ML concept"

  # --- Finance ---
  - query: "Black-Scholes option pricing model"
    expected_source_pattern: "option|derivatives|hull|hardy|pricing"
    expected_in_top_k: 5
    expected_concepts: ["Black-Scholes", "option pricing", "volatility", "geometric Brownian motion"]
    relevance_grade: 3
    tags: [phase_j, finance]
    notes: "Phase J: Core pricing model"

  - query: "portfolio optimization mean variance"
    expected_source_pattern: "portfolio|investment|optimization|finance|risk"
    expected_in_top_k: 5
    expected_concepts: ["mean-variance optimization", "efficient frontier", "Sharpe ratio"]
    relevance_grade: 3
    tags: [phase_j, finance]
    notes: "Phase J: Portfolio theory"

  - query: "value at risk VaR estimation"
    expected_source_pattern: "risk|derivatives|hull|finance|value"
    expected_in_top_k: 5
    expected_concepts: ["value at risk", "VaR", "expected shortfall", "risk measure"]
    relevance_grade: 3
    tags: [phase_j, finance]
    notes: "Phase J: Risk management"

  # --- Econometrics ---
  - query: "Gauss-Markov theorem OLS"
    expected_source_pattern: "econometric|analysis|wooldridge|panel|harmless"
    expected_in_top_k: 5
    expected_concepts: ["Gauss-Markov", "BLUE", "homoskedasticity", "exogeneity"]
    relevance_grade: 3
    tags: [phase_j, econometrics]
    notes: "Phase J: Fundamental econometrics result"

  - query: "Hausman test fixed effects random effects"
    expected_source_pattern: "econometric|panel|wooldridge|analysis"
    expected_in_top_k: 5
    expected_concepts: ["Hausman test", "fixed effects", "random effects", "specification test"]
    relevance_grade: 3
    tags: [phase_j, econometrics]
    notes: "Phase J: Panel data specification"

  # --- RAG & LLM ---
  - query: "retrieval augmented generation architecture"
    expected_source_pattern: "agents|action|generative|rag|retrieval"
    expected_in_top_k: 5
    expected_concepts: ["RAG", "retrieval", "generation", "context window"]
    relevance_grade: 3
    tags: [phase_j, rag_llm]
    notes: "Phase J: RAG architecture"

  - query: "chain of thought prompting"
    expected_source_pattern: "language|model|prompt|generative|few-shot"
    expected_in_top_k: 5
    expected_concepts: ["chain-of-thought", "prompting", "reasoning", "few-shot"]
    relevance_grade: 3
    tags: [phase_j, rag_llm]
    notes: "Phase J: Prompting technique"

  - query: "embedding similarity search"
    expected_source_pattern: "embedding|retrieval|vector|agents|ai"
    expected_in_top_k: 5
    expected_concepts: ["embedding", "similarity", "cosine similarity", "dense retrieval"]
    relevance_grade: 3
    tags: [phase_j, rag_llm]
    notes: "Phase J: Retrieval mechanism"

  # --- Mathematics ---
  - query: "singular value decomposition"
    expected_source_pattern: "linear algebra|mathematics|machine|matrix"
    expected_in_top_k: 5
    expected_concepts: ["SVD", "eigenvalue", "low-rank approximation", "matrix factorization"]
    relevance_grade: 3
    tags: [phase_j, mathematics]
    notes: "Phase J: Core linear algebra"

  - query: "gradient descent optimization convergence"
    expected_source_pattern: "optimization|mathematics|machine|deep"
    expected_in_top_k: 5
    expected_concepts: ["gradient descent", "convergence", "learning rate", "convexity"]
    relevance_grade: 3
    tags: [phase_j, mathematics]
    notes: "Phase J: Optimization fundamentals"

# Metrics targets (Master Plan Lines 1382-1383)
metrics:
  precision_at_5:
    target: 0.90
    description: "90% of top-5 results should be relevant"

  recall:
    target: 0.95
    description: "95% of relevant documents should be retrieved"
